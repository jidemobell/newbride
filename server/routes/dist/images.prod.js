"use strict";require("dotenv").config();var _process$env=process.env,CLOUDINARY_CLOUDNAME=_process$env.CLOUDINARY_CLOUDNAME,CLOUDINARY_API_KEY=_process$env.CLOUDINARY_API_KEY,CLOUDINARY_API_SECRET=_process$env.CLOUDINARY_API_SECRET,express=require("express"),router=express.Router(),cloudinary=require("cloudinary"),_require=require("../controllers/images"),upload=_require.upload,Database=require("../db/index"),pool=(new Database).startPool();cloudinary.config({cloud_name:CLOUDINARY_CLOUDNAME,api_key:CLOUDINARY_API_KEY,api_secret:CLOUDINARY_API_SECRET}),router.post("/uploadmutler",upload.single("imageData"),function(e,r,o){console.log("loading....");var n={text:"INSERT INTO bridal_app.images (name,image_url) VALUES ($1, $2)",values:[e.body.imageName,e.file.path]};pool.query(n).then(function(e){r.status(200).send(e)}).catch(function(e){return console.log(e)})}),router.get("/fetchimages",function(e,r){pool.query({text:"select * from bridal_app.images"}).then(function(e){r.status(200).send(e.rows)}).catch(function(e){return console.log(e)})}),router.get("/getcloudinaryphotos",function(e,r){cloudinary.v2.api.resources({type:"upload",prefix:"prinmia/"},function(e,r){e&&console.log(e);var o=r.resources;var n,t,a,u,c,i,s,l,p,d,_={text:"select * from bridal_app.cloudinary"};regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=!(n=!0),a=void 0,e.prev=3,u=o[Symbol.iterator]();!(n=(c=u.next()).done);n=!0)i=c.value,s=i.public_id,l=i.url,p=i.created_at,d={text:"INSERT INTO bridal_app.cloudinary (public_id, url, uploaded_at) VALUES ($1, $2, $3) ON CONFLICT ON CONSTRAINT cloudinary_public_id_key DO NOTHING;",values:[s,l,p]},pool.query(d).then(function(){return"done"}).catch(function(e){return console.log(e)});e.next=11;break;case 7:e.prev=7,e.t0=e.catch(3),t=!0,a=e.t0;case 11:e.prev=11,e.prev=12,n||null==u.return||u.return();case 14:if(e.prev=14,t)throw a;e.next=17;break;case 17:return e.finish(14);case 18:return e.finish(11);case 19:case"end":return e.stop()}},null,null,[[3,7,11,19],[12,,14,18]]).then(function(){pool.query(_).then(function(e){console.log(e.rows)}).catch(function(e){return console.log(e)})}).catch(function(e){return console.log(e)})})}),module.exports=router;